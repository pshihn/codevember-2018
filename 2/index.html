<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

  <meta property="og:title" content="Time - Codevember">
  <meta property="og:description" content="Every passing second sends a ripple along the cells. It's alive!">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://pshihn.github.io/codevember-2018/2/">
  <meta property="og:image" content="https://pshihn.github.io/codevember-2018/2/thumbnail.png">
  <meta property="og:image:width" content="200">
  <meta property="og:image:height" content="200">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@preetster">
  <meta name="twitter:title" content="Time - Codevember">
  <meta name="twitter:description" content="Every passing second sends a ripple along the cells. It's alive!">
  <meta name="twitter:image" content="https://pshihn.github.io/codevember-2018/2/thumbnail.png">
  <meta name="twitter:image:width" content="200">
  <meta name="twitter:image:height" content="200">

  <title>Time - Codevember</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      font-size: 16px;
      font-weight: 300;
      line-height: 1.5;
    }

    header {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px 16px 5px;
    }

    section.content {
      max-width: 600px;
      margin: 0 auto;
      padding: 0 16px;
    }

    h1 {
      font-weight: 400;
      margin: 0;
      letter-spacing: 0.1em;
      font-family: monospace;
    }

    a,
    a:visited {
      color: cadetblue;
      font-weight: 400;
      letter-spacing: 0.02em;
      text-decoration: none;
    }

    a:hover {
      box-shadow: 0 1px;
    }

    canvas {
      display: block;
      margin: 40px auto 20px;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <article>
    <header>
      <h1>Time</h1>
    </header>
    <main>
      <section class="content">
        <p>Every passing second sends a ripple along the cells. It's alive!</p>
        <p>This was created as part of
          <a href="https://pshihn.github.io/codevember-2018/">#codevemeber</a>
          for November 2, 2018 by <a href="https://twitter.com/preetster" target="_blank" rel="noopener">Preet</a>.</p>
      </section>
    </main>
  </article>


  <script>
    function ready() {
      const canvas = document.querySelector('canvas');
      const size = Math.min(800, window.innerHeight, window.innerWidth) - 10;
      canvas.width = size;
      canvas.height = size;
      console.log(d3);

      var n = 10;

      var nodes = d3.range(n * n).map(function (i) {
        return {
          index: i
        };
      });

      var links = [];

      for (var y = 0; y < n; ++y) {
        for (var x = 0; x < n; ++x) {
          if (y > 0) links.push({ source: (y - 1) * n + x, target: y * n + x });
          if (x > 0) links.push({ source: y * n + (x - 1), target: y * n + x });
        }
      }

      var simulation = d3.forceSimulation(nodes)
        .force("charge", d3.forceManyBody().strength(-30))
        .force("link", d3.forceLink(links).strength(1).distance(20).iterations(10))
        .on("tick", ticked);

      var context = canvas.getContext("2d"),
        width = canvas.width,
        height = canvas.height;

      d3.select(canvas)
        .call(d3.drag()
          .container(canvas)
          .subject(dragsubject)
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended));

      function ticked() {
        context.clearRect(0, 0, width, height);
        context.save();
        context.translate(width / 2, height / 2);

        context.beginPath();
        links.forEach(drawLink);
        context.strokeStyle = "#aaa";
        context.stroke();

        context.beginPath();
        nodes.forEach(drawNode);
        context.fill();
        context.strokeStyle = "#fff";
        context.stroke();

        context.restore();
      }

      function dragsubject() {
        return simulation.find(d3.event.x - width / 2, d3.event.y - height / 2);
      }

      function dragstarted() {
        if (!d3.event.active) simulation.alphaTarget(0.3).restart();
        d3.event.subject.fx = d3.event.subject.x;
        d3.event.subject.fy = d3.event.subject.y;
      }

      function dragged() {
        d3.event.subject.fx = d3.event.x;
        d3.event.subject.fy = d3.event.y;
      }

      function dragended() {
        if (!d3.event.active) simulation.alphaTarget(0);
        d3.event.subject.fx = null;
        d3.event.subject.fy = null;
      }

      function drawLink(d) {
        context.moveTo(d.source.x, d.source.y);
        context.lineTo(d.target.x, d.target.y);
      }

      function drawNode(d) {
        context.moveTo(d.x + 3, d.y);
        context.arc(d.x, d.y, 3, 0, 2 * Math.PI);
      }
    }
  </script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/p5.js"></script>
  <script defer src="https://d3js.org/d3.v4.min.js"></script>
  <script defer src="./sketch.js"></script>
</body>

</html>